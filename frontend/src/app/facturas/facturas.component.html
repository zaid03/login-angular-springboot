<div class="facturas-page">
    <div 
        class="sidebar-backdrop" 
        *ngIf="!sidebar.collapsed" 
        (click)="sidebar.collapsed = true"
    >
    </div>
    <app-sidebar #sidebar></app-sidebar>
    <div class="facturas-container" [class.blurred]="!sidebar.collapsed">
        <div class="title-menu">
            <div class="title-area">
                <h2 class="margin-title">Gestión de facturas</h2>  
            </div>
            <div class="search-holder">
                <div class="search-container">
                    <div class="search-form">
                        <input 
                            type="text" 
                            class="search-bar" 
                            placeholder="factura" 
                            name="search"
                            [(ngModel)]="searchQuery"
                        >
                        <input 
                            type="text" 
                            name="factura" 
                            class="search-bar smallWidth"
                            placeholder="Eje"
                            [(ngModel)]="facturaSearch"
                            maxlength="4"
                            inputmode="numeric"
                            pattern="[0-9]*"
                            (input)="onEjeInput($event)"
                        />
                        <input 
                            type="text" 
                            name="Gestor" 
                            class="search-bar smallWidth"
                            placeholder="centro de gestión faltante"
                            [(ngModel)]="centroGestor"
                            maxlength="4"
                            disabled
                        />
                        <div class="more-search-options">
                            <select [(ngModel)]="fechaTipo">
                                <option value="" disabled selected>Fecha</option>
                                <option value="registro">Registro</option>
                                <option value="factura">Factura</option>
                                <option value="contable">Contable</option>
                            </select>
                            Desde
                            <input 
                                type="date" 
                                name="desde" 
                                class="fecha-dato" 
                                [(ngModel)] = "fromDate"
                            >   
                            Hasta
                            <input 
                                type="date" 
                                name="hasta" 
                                class="fecha-dato" 
                                [(ngModel)] = "toDate"
                            > 
                            <select [(ngModel)]="estadoTipo">
                                <option value="contabilizadas">Contabilizadas</option>
                                <option value="no-contabilizadas">No Contabilizadas</option>
                                <option value="aplicadas">Ptes. Aplicadas</option>
                                <option value="sin-aplicadas">Ptes. Sin aplicar</option>
                                <option value="">Todas</option>
                            </select>
                        </div>
                    </div>
                    <div class="btns">
                        <button type="button" class="search-button" (click)="filterFacturas()">Buscar</button>
                        <button type="button" class="search-btn" (click)="forgetAll()">Limpiar</button>
                    </div>
                </div>
            </div>
            <div class="group-menu" (click)="toggleMenu($event)">
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="menu-panel" *ngIf="showMenu">
                    <button class="download-btn" (click)="DownloadPDF()">Exportar a PDF</button>
                    <button class="download-btn" (click)="DownloadCSV()">Exportar a CSV</button>
                    <button class="download-btn" (click)="openFacturaAdd()">Cargar facturas</button>
                </div>
            </div>
        </div>
        <h1 class="successBtn">{{ estadoMessage }}</h1>
        <h1 class="errorBtn">{{ filterFacturaMessage }}</h1>
        <div class="facturas-list">
            <div *ngIf="isLoading" class="loading-message">
                <div class="spinner"></div>
                <span>Cargando</span>
            </div>
            <table class="facturas-table">
                <thead>
                    <tr>
                        <th class="sortable resizable" (click)="toggleSort('facnum')">
                            Número Registro 
                            <span class="sort-indicator" *ngIf="sortColumn === 'facnum'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span>
                            <div class="resizer" (mousedown)="startResize($event, 0)"></div>
                        </th>
                        <th class="sortable resizable" (click)="toggleSort('tercod')">
                            Código Prov
                            <span class="sort-indicator" *ngIf="sortColumn === 'tercod'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span>
                            <div class="resizer" (mousedown)="startResize($event, 1)"></div>
                        </th>
                        <th class="sortable resizable" (click)="toggleSort('ternom')">
                            Nombre Proveedor
                            <span class="sort-indicator" *ngIf="sortColumn === 'ternom'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span>
                            <div class="resizer" (mousedown)="startResize($event, 2)"></div>
                        </th>
                        <th class="sortable resizable" (click)="toggleSort('ternif')">
                            NIF Prov
                            <span class="sort-indicator" *ngIf="sortColumn === 'ternif'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span>
                            <div class="resizer" (mousedown)="startResize($event, 3)"></div>
                        </th>
                        <th class="sortable resizable" (click)="toggleSort('facfre')">
                            F.Registro
                            <span class="sort-indicator" *ngIf="sortColumn === 'facfre'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span>
                            <div class="resizer" (mousedown)="startResize($event, 4)"></div>
                        </th>
                        <th class="sortable resizable" (click)="toggleSort('facimp')">
                            Importe total
                            <span class="sort-indicator" *ngIf="sortColumn === 'facimp'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span>
                            <div class="resizer" (mousedown)="startResize($event, 5)"></div>
                        </th>
                        <th class="sortable resizable" (click)="toggleSort('facdoc')">
                            Núm. Factura
                            <span class="sort-indicator" *ngIf="sortColumn === 'facdoc'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span>
                            <div class="resizer" (mousedown)="startResize($event, 6)"></div>
                        </th>
                        <th class="sortable resizable" (click)="toggleSort('facann')">
                            Año
                            <span class="sort-indicator" *ngIf="sortColumn === 'facann'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span>
                            <div class="resizer" (mousedown)="startResize($event, 7)"></div>
                        </th>
                        <th class="sortable resizable" (click)="toggleSort('facfac')">
                            R.C.F
                            <span class="sort-indicator" *ngIf="sortColumn === 'facfac'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span>
                            <div class="resizer" (mousedown)="startResize($event, 8)"></div>
                        </th>
                        <th class="sortable resizable" (click)="toggleSort('facdat')">
                            F.Factura
                            <span class="sort-indicator" *ngIf="sortColumn === 'facdat'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span>
                            <div class="resizer" (mousedown)="startResize($event, 9)"></div>
                        </th>
                        <th class="sortable resizable" (click)="toggleSort('facado')">
                            ADO
                            <span class="sort-indicator" *ngIf="sortColumn === 'facado'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span>
                            <div class="resizer" (mousedown)="startResize($event, 10)"></div>
                        </th>
                        <th class="sortable resizable" (click)="toggleSort('facfco')">
                            F.contable
                            <span class="sort-indicator" *ngIf="sortColumn === 'facfco'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span>
                            <div class="resizer" (mousedown)="startResize($event, 11)"></div>
                        </th>
                        <th class="sortable resizable" (click)="toggleSort('getPendingApply(p)')">
                            Pte. Aplicar
                            <span class="sort-indicator" *ngIf="sortColumn === 'getPendingApply(p)'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span>
                            <div class="resizer" (mousedown)="startResize($event, 12)"></div>
                        </th>
                        <th class="sortable resizable" (click)="toggleSort('cgecod')">
                            C.Gestor
                            <span class="sort-indicator" *ngIf="sortColumn === 'cgecod'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span>
                            <div class="resizer" (mousedown)="startResize($event, 13)"></div>
                        </th>
                        <th class="sortable resizable" (click)="toggleSort('getStaus(p.facado, p.facimp, p.faciec, p.facidi)')">
                            Estado
                            <span class="sort-indicator" *ngIf="sortColumn === 'getStaus(p.facado, p.facimp, p.faciec, p.facidi)'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span>
                            <div class="resizer" (mousedown)="startResize($event, 14)"></div>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let p of paginatedFacturas">
                        <td (click)="showDetails(p)" style="cursor: pointer;">{{ p.facnum }}</td>
                        <td>{{ p.tercod }}</td>
                        <td>{{ p.ternom }}</td>
                        <td>{{ p.ternif }}</td>
                        <td>{{ p.facfre | date:'dd-MM-yyyy'}}</td>
                        <td>{{ p.facimp | currency:'EUR':'symbol':'1.2-2':'es-ES' }}</td>
                        <td>{{ p.facdoc }}</td>
                        <td>{{ p.facann }}</td>
                        <td>{{ p.facfac }}</td>
                        <td>{{ p.facdat | date:'dd-MM-yyyy' }}</td>
                        <td>{{ p.facado }}</td>
                        <td>{{ p.facfco | date:'dd-MM-yyyy' }}</td>
                        <td>{{getPendingApply(p) | currency:'EUR':'symbol':'1.2-2':'es-ES'}}</td>
                        <td>{{ p.cgecod }}</td>
                        <td>{{ getStaus(p.facado, p.facimp, p.faciec, p.facidi) }}</td>
                    </tr>
                </tbody>
            </table>
            <div class="pagination-controls">
                <button (click)="prevPage()" [disabled]="page === 0">Anterior</button>
                <span>Página</span>
                <input
                type="number"
                min="1"
                [max]="totalPages"
                [value]="page + 1"
                (change)="goToPage($event)"
                class="pagination-input"
                />
                <span>de {{ totalPages }}</span>
                <button (click)="nextPage()" [disabled]="page + 1 >= totalPages">Siguiente</button>
            </div>
            <div class="modal-backdrop" *ngIf="selectedFacturas" (click)="closeDetails()"></div>
            <div class="display" >
                <div class="modal" *ngIf="selectedFacturas">
                    <div class="btns">
                        <div class="title-detail">
                            <h3>Detalles del Factura</h3>
                        </div>
                        <button class="guardar-btn" (click)="updateFactura()">✔</button>
                        <button class="close-btn-btn" (click)="closeDetails()">✖</button>
                    </div>
                    <div *ngIf="isUpdatingFactura" class="loading-message">
                        <div class="spinner"></div>
                        <span>actualizando</span>
                    </div>
                    <h1 class="successBtn">{{facturaDetailSuccess}}</h1>
                    <h1 class="errorBtn">{{facturaDetailError}}</h1>
                    <div class="detail-container">
                        <div class="chunk-one">
                            <div class="left">
                                <p>Núm. Reg.</p>
                                <p>Núm.Factura:</p>
                                <p>R.C.F:</p>
                            </div>
                            <div class="right gap">
                                <div class="on-two">
                                    <h1>{{selectedFacturas.facnum || '#'}}</h1>
                                    <p>F.Contable</p>
                                    <h1>{{selectedFacturas.facfco | date:'dd-MM-yyyy'}}</h1>
                                </div>
                                <h1>{{selectedFacturas.facdoc || '#'}}</h1>
                                <div class="on-two">
                                    <h1>{{selectedFacturas.facfac || '#'}}</h1>
                                    <h1>{{selectedFacturas.facann || '#'}}</h1>
                                    <h1>{{selectedFacturas.factdc || '#'}}</h1>
                                </div>
                            </div>
                        </div>
                        <div class="chunk-two">
                            <div class="left">
                                <p>Proveedor:</p>
                                <p>NIF</p>
                                <p>Fecha Factura</p>
                            </div>
                            <div class="right">
                                <div class="on-two">
                                    <h1>{{selectedFacturas.tercod || '#'}}</h1>
                                    <h1>{{selectedFacturas.ter_TERNOM || '#'}}</h1>
                                </div>
                                <div class="on-two">
                                    <h1>{{selectedFacturas.ter_TERNIF || '#'}}</h1>
                                    <p>C.Gestor</p>
                                    <h1>{{selectedFacturas.cgecod || '#'}}</h1>
                                </div>
                                <div class="on-two">
                                    <h1>{{selectedFacturas.facdat | date:'dd-MM-yyyy'}}</h1>
                                    <p>F.Registro</p>
                                    <input
                                        type="date"
                                        class="input-style" 
                                        [(ngModel)]="selectedFacturas.facfre"
                                    />
                                </div>
                            </div>
                        </div>
                        <div class="chunk-three special-chunk">
                            <div class="left special-needs gap">
                                <p>Tipo de contrato</p>
                                <p>Criterio de puntuación</p>
                                <p>Procedimiento de contacto</p>
                            </div>
                            <div class="right gap">
                                <textarea 
                                    class="averageSecond" 
                                    [(ngModel)]="selectedFacturas.conctp"
                                ></textarea>
                                <textarea 
                                    class="averageSecond" 
                                    [(ngModel)]="selectedFacturas.concpr"
                                ></textarea>
                                <textarea 
                                    class="averageSecond" 
                                    [(ngModel)]="selectedFacturas.conccr"
                                ></textarea>
                            </div>
                        </div>
                        <div class="chunk-four">
                            <div class="left">
                                <p>Forma de pago</p>
                                <p>Ordinal de pago</p>     
                            </div>
                            <div class="right">
                                <div class="on-two">
                                    <textarea 
                                        class="pagoSmallWidth" 
                                        [(ngModel)]="selectedFacturas.facfpg"
                                    ></textarea>
                                    <p>Tipo de pago</p>
                                    <textarea 
                                        class="pagoSmallWidth pagoFix" 
                                        [(ngModel)]="selectedFacturas.factpg"
                                    ></textarea>
                                </div>
                                <div class="on-two">
                                    <textarea 
                                        class="pagoSmallWidth " 
                                        [(ngModel)]="selectedFacturas.facopg"
                                    ></textarea>
                                    <p>Cuenta Tercero</p>
                                    <textarea 
                                        class="pagoSmallWidth" 
                                        [(ngModel)]="selectedFacturas.facoct"
                                    ></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="chunk-five">
                            <div class="left moreGap">
                                <p>Des.Fact/ADO:</p>
                                <p>ADO</p>
                            </div>
                            <div class="right">
                                <h1>{{selectedFacturas.factxt || '#'}}</h1>
                                <h1>{{selectedFacturas.facado || '#'}}</h1>
                            </div>
                        </div>
                        <div class="chunk-six">
                            <div class="left gap">
                                <p>Total Factura</p>
                                <p>Apl.diferencias</p>
                                <p>Descuentos</p>
                            </div>
                            <div class="right gap">
                                <div class="on-two">
                                    <h1>{{selectedFacturas?.facimp ? (selectedFacturas.facimp | currency:'EUR':'symbol':'1.2-2':'es-ES') : '#'}}</h1>
                                    <p>Aplicado</p>
                                    <h1>{{selectedFacturas?.faciec ? (selectedFacturas.faciec | currency:'EUR':'symbol':'1.2-2':'es-ES') : '#'}}</h1>
                                </div>
                                <div class="on-two">
                                    <h1>{{selectedFacturas?.facidi ? (selectedFacturas.facidi | currency:'EUR':'symbol':'1.2-2':'es-ES') : '#'}}</h1>
                                    <p>Pte.Apli</p>
                                    <h1>{{getPendingApply(selectedFacturas) ? (getPendingApply(selectedFacturas) | currency:'EUR':'symbol':'1.2-2':'es-ES') : '#'}}</h1>
                                </div>
                                <h1>{{selectedFacturas?.facdto ? (selectedFacturas.facdto | currency:'EUR':'symbol':'1.2-2':'es-ES') : '#'}}</h1>
                            </div>
                        </div>
                        <div class="observ">
                            <p>Observaciones:</p>
                            <textarea [(ngModel)]="selectedFacturas.facobs"></textarea>
                        </div>
                    </div>
                    <div class="more-detail-container">
                        <div class="tabs" role="tablist" aria-label="Detalle tabs">
                            <button
                                class="tab-btn"
                                role="tab" 
                                type="button"
                                [class.active]="detailView === 'Albaranes'"
                                (click)="detailView = 'Albaranes'"
                            >
                                Albaranes
                            </button>
                            <button 
                                class="tab-btn"
                                role="tab" 
                                type="button"
                                [class.active]="detailView === 'Contabilización'"
                                (click)="detailView = 'Contabilización'"
                            >
                                Datos Contabilización
                            </button>
                        </div>
                    </div>
                    <div class="more-details">
                        <div class="detail-grid" *ngIf="detailView === 'Albaranes'">
                            <div class="more-detail-container">
                                <div class="tabs" role="tablist" aria-label="Opciones de Albaranes">
                                    <button
                                        class="tab-btn"
                                        role="tab"
                                        type="button"
                                        [class.active]="albaranesOptio === 'albaranes'"
                                        (click)="setAlbaranesOptio('albaranes', selectedFacturas?.facnum)"
                                    >
                                        Albaranes
                                    </button>
                                    <button
                                        class="tab-btn"
                                        role="tab"
                                        type="button"
                                        [class.active]="albaranesOptio === 'aplicaciones'"
                                        (click)="setAlbaranesOptio('aplicaciones', selectedFacturas?.facnum)"
                                    >
                                        Aplicaciones
                                    </button>
                                    <button
                                        class="tab-btn"
                                        role="tab"
                                        type="button"
                                        [class.active]="albaranesOptio === 'descuentos'"
                                        (click)="setAlbaranesOptio('descuentos', selectedFacturas?.facnum)"
                                    >
                                        Descuentos
                                    </button>
                                </div>
                            </div>
                            <div class="detail-switch-second-content">
                                <ng-container [ngSwitch]="albaranesOptio">
                                    <ng-container *ngSwitchCase="'albaranes'">
                                        <div class="albaranes-btns">
                                            <button class="save-btn" (click)="openAlbaranesAdd()">+</button>
                                        </div>
                                        <h1 class="successBtn">{{moreInfoMessageSuccess}}</h1>
                                        <h1 class="errorBtn">{{moreInfoMessageError}}</h1>
                                        <div *ngIf="isLoading" class="loading-message">
                                            <div class="spinner"></div>
                                            <span>Cargando</span>
                                        </div>
                                        <div class="detail-card">
                                            <table class="albaranes-table width-last">
                                                <thead>
                                                    <tr>
                                                        <th>Número albarán</th>
                                                        <th>Referencia</th>
                                                        <th>Fecha</th>
                                                        <th>Base imponible</th>
                                                        <th>Solicitud</th>
                                                        <th>Índice</th>
                                                        <th>Observaciones</th>
                                                        <th>acción</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr *ngFor="let a of paginatedAlbaranes">
                                                        <td>{{ a.albnun }}</td>
                                                        <td>{{ a.albref }}</td>
                                                        <td>{{ a.albdat | date:'dd-MM-yyyy' }}</td>
                                                        <td>{{ a.albbim | currency:'EUR':'symbol':'1.2-2':'es-ES' }}</td>
                                                        <td>{{ a.solnum }}</td>
                                                        <td>{{ a.solsub }}</td>
                                                        <td>{{ a.albobs }}</td>
                                                        <td>
                                                            <button class="delete-btn" (click)="showDeleteAlbaran(a)">-</button>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                            <div class="pagination-controls alignment">
                                                <button (click)="prevPageAlbaranes()" [disabled]="pageAlbaranes === 0">Anterior</button>
                                                <span>Página</span>
                                                <input
                                                    type="number"
                                                    min="1"
                                                    [max]="totalPagesAlbaranes"
                                                    [value]="pageAlbaranes + 1"
                                                    (change)="goToPageAlbaranes($event)"
                                                    class="pagination-input"
                                                />
                                                <span>de {{ totalPagesAlbaranes }}</span>
                                                <button (click)="nextPageAlbaranes()" [disabled]="pageAlbaranes + 1 >= totalPagesAlbaranes">Siguiente</button>
                                            </div>
                                        </div>
                                    </ng-container>
                                    <ng-container *ngSwitchCase="'aplicaciones'">
                                        <h1 class="successBtn">{{moreInfoMessageSuccess}}</h1>
                                        <h1 class="errorBtn">{{moreInfoMessageError}}</h1>
                                        <div *ngIf="isLoading" class="loading-message">
                                            <div class="spinner"></div>
                                            <span>Cargando</span>
                                        </div>
                                        <div class="detail-card">
                                            <table class="albaranes-table app">
                                                <thead>
                                                    <tr>
                                                        <th><strong>Referencia</strong></th>
                                                        <th>Económica</th>
                                                        <th>Importe</th>
                                                        <th>diferencias </th>
                                                        <th>acción</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr *ngFor="let a of paginatedApiciones">
                                                        <td>{{ a.FDEREF }}</td>
                                                        <td>{{ a.FDEECO }}</td>
                                                        <td>{{ a.FDEIMP | currency:'EUR':'symbol':'1.2-2':'es-ES' }}</td>
                                                        <td>
                                                            <textarea 
                                                                class="applicacionesTextarea" 
                                                                [(ngModel)]="a.FDEDIF"
                                                                (blur)="formatapplicaciones(a)"
                                                            ></textarea>
                                                        </td>
                                                        <td>
                                                            <button class="save-btn">✔</button>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                            <div class="pagination-controls alignment">
                                                <button (click)="prevPageAplicaiones()" [disabled]="pageAplicaiones === 0">Anterior</button>
                                                <span>Página</span>
                                                <input
                                                    type="number"
                                                    min="1"
                                                    [max]="totalPagesAplicaciones"
                                                    [value]="pageAplicaiones + 1"
                                                    (change)="goToPageAplicaciones($event)"
                                                    class="pagination-input"
                                                />
                                                <span>de {{ totalPagesAplicaciones }}</span>
                                                <button (click)="nextPageAplicaciones()" [disabled]="pageAplicaiones + 1 >= totalPagesAplicaciones">Siguiente</button>
                                            </div>
                                        </div>
                                    </ng-container>
                                    <ng-container    *ngSwitchCase="'descuentos'">
                                        <h1 class="successBtn">{{moreInfoMessageSuccess}}</h1>
                                        <h1 class="errorBtn">{{moreInfoMessageError}}</h1>
                                        <div *ngIf="isLoading" class="loading-message">
                                            <div class="spinner"></div>
                                            <span>Cargando</span>
                                        </div>
                                        <div class="detail-card">
                                            <table class="albaranes-table desc">
                                                <thead>
                                                    <tr>
                                                        <th>Área</th>
                                                        <th>Orgánica</th>
                                                        <th>Programa</th>
                                                        <th>Económica</th>
                                                        <th>Base</th>
                                                        <th>% Dto</th>
                                                        <th>Importe Descuento</th>
                                                        <th>Descripción</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr *ngFor="let d of paginatedDescuentos">
                                                        <td>{{ d.FDTARE }}</td>
                                                        <td>{{ d.FDTORG }}</td>
                                                        <td>{{ d.FDTFUN }}</td>
                                                        <td>{{ d.FDTECO }}</td>
                                                        <td>{{ d.FDTBSE | currency:'EUR':'symbol':'1.2-2':'es-ES' }}</td>
                                                        <td>{{ d.FDTPRE | number:'1.1-1' }} %</td>
                                                        <td>{{ d.FDTDTO | currency:'EUR':'symbol':'1.2-2':'es-ES' }}</td>
                                                        <td>{{ d.FDTTXT }}</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                            <div class="pagination-controls alignment">
                                                <button (click)="prevPageDescuentos()" [disabled]="pageDescuentos === 0">Anterior</button>
                                                <span>Página</span>
                                                <input
                                                    type="number"
                                                    min="1"
                                                    [max]="totalPagesDescuentos"
                                                    [value]="pageDescuentos + 1"
                                                    (change)="goToPageDescuentos($event)"
                                                    class="pagination-input"
                                                />
                                                <span>de {{ totalPagesDescuentos }}</span>
                                                <button (click)="nextPageDescuentos()" [disabled]="pageDescuentos + 1 >= totalPagesDescuentos">Siguiente</button>
                                            </div>
                                        </div>
                                    </ng-container>
                                </ng-container>
                            </div>
                        </div>
                        <div class="detail-grid" *ngIf="detailView === 'Contabilización'">
                            <div class="detail-card">
                                <h4>Later</h4>
                            </div>
                        </div>
                    </div>
                </div> 
            </div>
        </div>
    </div>
</div>

<div class="modal-backdrop" *ngIf="addFacturaGrid" (click)="closeFacturaAdd()"></div>
<div class="factura-cargar" *ngIf="addFacturaGrid">
    <div class="btns">
        <div class="title">
            <h1 class="art-title">Cargar facturas</h1>
        </div>
        <button class="save-btn" (click)="addingFacturas()">+</button>
        <button class="delete-btn" (click)="closeFacturaAdd()">✖</button>
    </div>
    <div class="search-option-container">
        <div class="chunk-one-search">
            <div class="left-search">
                <p>Nif Proveedor</p>
                <p>N° Factura</p>
            </div>
            <div class="right-search">
                <input 
                    placeholder="Nif Proveedor"
                    type="text"
                    [(ngModel)]="proveedor"
                    class="widthIput"
                />
                <input 
                    placeholder="N° Factura"
                    type="text"
                    [(ngModel)]="facturaNumero" 
                    class="widthIput"
                />
            </div>
        </div>
        <div class="chunk-one-search">
            <div class="left-search alignTitleSearch">
                <p>Fecha entrada RCF</p>
            </div>
            <div class="right-search">
                <input 
                    type="date"
                    [(ngModel)]="RcfDesde" 
                    class="widthIput"
                />
                <input 
                    type="date"
                    [(ngModel)]="RcfHasta"
                    class="widthIput"
                />
            </div>
        </div>
        <div class="chunk-one-search">
            <div class="left-search alignTitleSearch">
                <p>Fecha factura</p>
            </div>
            <div class="right-search">
                <input 
                    type="date"
                    [(ngModel)]="fechaFacturaDesde" 
                    class="widthIput"
                />
                <input 
                    type="date"
                    [(ngModel)]="fechaFacturaHasta" 
                    class="widthIput"
                />
            </div>
        </div>
        <div class="search-options-btns">
            <button class="download-btn" (click)="searchFacturas()">Buscar</button>
            <button class="download-btn" (click)="clearSearch()">Limpiar</button>
        </div>
    </div>
    <h1 class="errorBtn">{{facturasErrorMessage}}</h1>
    <h1 class="sucessBtn">{{facturasSuccessMessage}}</h1>
    <div *ngIf="isLoadingFactura" class="loading-message">
        <div class="spinner"></div>
        <span>Cargando</span>
    </div>
    <div *ngIf="isAddingFactura" class="loading-message">
        <div class="spinner"></div>
        <span>añadiendo</span>
    </div>
    <table class="D-table">
        <thead>
            <tr>
                <th>Tipo</th>
                <th>Ejercicio</th>
                <th>Nº R.C.F.</th>
                <th>Nº factura </th>
                <th>Importe</th>
                <th>Fecha Ent. Registro</th>
                <th>Fecha Factura</th>
                <th>NIF</th>
                <th>Descripción</th>
                <th>Nombre</th>
            </tr>
        </thead>
        <tbody>
            <tr 
                *ngFor="let f of paginatedFacturaWs"
                (click)="selectFacturasAdd(f)"
            >
                <td>{{f.tipoRegistro}}</td>
                <td>{{f.annoRegistro}}</td>
                <td>{{f.numRegistro}}</td>
                <td>{{f.numDocumento}}</td>
                <td>{{f.impFactura}}</td>
                <td>{{f.fecRegistro}}</td>
                <td>{{f.fechaDocumento}}</td>
                <td>{{f.tercero}}</td>
                <td>{{f.Texto}}</td>
                <td>{{f.nombreTercero}}</td>
            </tr>
        </tbody>
    </table>
    <p class="selected" *ngIf="caughtFacturas.length > 0">{{caughtFacturas.length}} Facturas seleccionados</p>
    <div class="pagination-controls alignment">
        <button (click)="prevPageFacturas()" [disabled]="pageFacturas === 0">Anterior</button>
        <span>Página</span>
        <input
            type="number"
            min="1"
            [max]="totalPagesFacturas"
            [value]="pageFacturas + 1"
            (change)="goToPageFacturas($event)"
            class="pagination-input"
        />
        <span>de {{ totalPagesFacturas }}</span>
        <button (click)="nextPageFacturas()" [disabled]="pageFacturas + 1 >= totalPagesFacturas">Siguiente</button>
    </div>
</div>

<div class="modal-backdrop" *ngIf="albaranesAddGrid" (click)="closeAlbaranesAdd()"></div>
<div class="factura-cargar albran-add" *ngIf="albaranesAddGrid">
    <div class="btns">
        <div class="title">
            <h1 class="art-title">añadir albaranes</h1>
        </div>
        <button class="save-btn" (click)="adingAlbaranes()">+</button>
        <button class="delete-btn" (click)="closeAlbaranesAdd()">✖</button>
    </div>
    <div class="albaran-search-options">
        <div class="proveedor-info">
            <p>Código proveedor</p>
            <h1>{{tercod}}</h1>
        </div>
        <div class="search-chunk">
            <p>Desde</p>
            <input 
                type="date"
                [(ngModel)]="albaranesDesde" 
                class="widthInputAlbaran"
            />
        </div>
        <div class="search-chunk">
            <p>Hasta</p>
            <input 
                type="date"
                [(ngModel)]="albaranesHasta" 
                class="widthInputAlbaran"
            />
        </div>
        <div class="albaran-options-btns">
            <button class="download-btn" (click)="searchAlbaranes()">Buscar</button>
            <button class="download-btn" (click)="limpiarSearch()">Limpiar</button>
        </div>
    </div>
    <h1 class="errorBtn">{{albaranesError}}</h1>
    <div *ngIf="isLoadingAlbaranes" class="loading-message">
        <div class="spinner"></div>
        <span>Cargando</span>
    </div>
    <div *ngIf="isAddingAlbaranes" class="loading-message">
        <div class="spinner"></div>
        <span>añadiendo</span>
    </div>
    <table class="albaranes-table">
        <thead>
            <tr>
                <th>Referencia proveïdor</th>
                <th>Fecha</th>
                <th>Importe</th>
                <th>Reg. Entrada</th>
                <th>Fecha registro</th>
                <th>Centro destino</th>
                <th>Centro Comprador</th>
            </tr>
        </thead>
        <tbody>
            <tr 
                *ngFor="let a of paginatedAlbaranesAdd"
                (click)="selectAlbaranesAdd(a)"
                [class.selected-row]="isAlbaranesSelected(a)"
            >
                <td>{{a.albref}}</td>
                <td>{{a.albdat}}</td>
                <td>{{a.albbim}}</td>
                <td>{{a.albnum}}</td>
                <td>{{a.albfre}}</td>
                <td>{{a.depcod}}</td>
                <td>{{a.albcom}}</td>
            </tr>
        </tbody>
    </table>
    <p class="selected" *ngIf="caughtAlbranaes.length > 0">{{caughtAlbranaes.length}} Albaranes seleccionados</p>
    <div class="pagination-controls alignment">
        <button (click)="prevPageAlbaranesAdd()" [disabled]="pageAlbaranesAdd === 0">Anterior</button>
        <span>Página</span>
        <input
            type="number"
            min="1"
            [max]="totalPagesAlbaranesAdd"
            [value]="pageAlbaranesAdd + 1"
            (change)="goToPageAlbaranesAdd($event)"
            class="pagination-input"
        />
        <span>de {{ totalPagesAlbaranesAdd }}</span>
        <button (click)="nextPageAlbaraneAdd()" [disabled]="pageAlbaranesAdd + 1 >= totalPagesAlbaranesAdd">Siguiente</button>
    </div>
</div>

<div class="modal-backdrop" *ngIf="deleteAlbaranGrid" (click)="closeDeleteAlbaran()"></div>
<div class="delete-confirm-modal" *ngIf="deleteAlbaranGrid">
    <h3>¿Quiere quitar el albarán de la factura?</h3>
    <div *ngIf="albaranToDelete">
        <div *ngIf="isDeletingAlbaranes" class="loading-message">
            <div class="spinner"></div>
            <span>borrando</span>
        </div>
        <p class="delete-info">Número albarán: {{albaranToDelete.albnun}}</p>
    </div>
    <h1 class="errorBtn">{{dalbaranesDeleteMessage}}</h1>
    <button class="delete-btn" (click)="quitarAlbaran()">-</button>
    <button class="save-btn margin" (click)="closeDeleteAlbaran()">✖</button>
</div>